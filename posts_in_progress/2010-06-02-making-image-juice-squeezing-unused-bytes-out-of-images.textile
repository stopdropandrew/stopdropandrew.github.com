---
layout: post
title: "Making image juice: squeezing the unused bytes out of your images"
---

<img src="/images/squeeze_pop.jpg">

Image size is definitely a case of "less is more." Many images on the web are larger than they need to be, and there has been a recent surge in the movement to strip out excess bits while maintaining a lossless image.  <a href="http://www.smushit.com/ysmush.it/">Smush.itâ„¢</a> is a great example. Unfortunately, even though it runs on open source image utilities, there is no API and <a href="http://www.yahoo.com">Yahoo!</a> seems to have no plan to release an open source version.

Have no fear! It isn't doing anything complicated, so why not just do it ourselves.  At least the original authors basically laid out what they do in the excellent <a href="http://www.amazon.com/Even-Faster-Web-Sites-Performance/dp/0596522304">Even Faster Web Sites</a>.

h3. Image Squeeze

<a href="http://www.github.com/stopdropandrew/image_squeeze">Image Squeeze</a> is a pluggable library for optimizing images. The only library it requires is ImageMagick (specifically it uses identify to figure out what type of image it's looking at). The default processors included with the library require pngcrush, jpegtran, gifsicle, and ImageMagick's convert. Here's an quick example:

    # set up an ImageSqueeze with the default processors
    squeezer = ImageSqueeze.new(:default_processors => true)

    # in-place squeeze of our png
    squeezer.squeeze!('my_logo.png')

If you don't want to install one of those for some reason, don't worry, image_squeeze just won't include the processor if the utility isn't available.

h3. Adding your own processors

Let's say pngcrush isn't good enough for you, and you want to add an optipng processor as well.  Easy enough, we can just plug that in.

<script src="http://gist.github.com/421846.js?file=OptiPNGProcessor"></script>

So you just need to implement two methods, once which returns an image type (constants defined in ImageSqueeze) and a squeeze method (takes an input filename and leaves a new image in the output filename). *Note:* The default processors are all lossless quality, if you implement your own it's up to you to verify that you aren't losing quality.

Now let's load it in with our defaults,

    squeezer = ImageSqueeze.new(:default_processors => true, :processors => [ImageSqueeze::OptiPNGProcessor])

Or you don't like the defaults, just include your own

    squeezer = ImageSqueeze.new(:processors => [ImageSqueeze::OptiPNGProcessor])

